<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" 
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
              xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports 
              http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" 
              name="matricula" pageWidth="595" pageHeight="842" 
              columnWidth="555" leftMargin="20" rightMargin="20" 
              topMargin="20" bottomMargin="20" uuid="a6b8c7d8-e9f0-4a1b-9c8d-7e6f5a4b3c2d">
    
    <property name="com.jaspersoft.studio.data.defaultdataadapter" value="One Empty Record"/>
    
    <parameter name="curso" class="java.lang.Integer"/>
    <parameter name="dataInicio" class="java.lang.String"/>
    <parameter name="dataFinal" class="java.lang.String"/>
    
    <queryString>
        <![CDATA[
        SELECT 
            m.id,
            a.nome as aluno_nome,
            a.cpf,
            c.titulo as curso_titulo,
            m.data_matricula,
            m.status,
            p.nome as parceiro_nome
        FROM matricula m
        LEFT JOIN aluno a ON m.aluno_id = a.id
        LEFT JOIN curso c ON m.curso_id = c.id
        LEFT JOIN parceiro p ON a.parceiro_id = p.id
        WHERE 1=1
        AND ($P{curso} IS NULL OR c.id = $P{curso})
        AND ($P{dataInicio} IS NULL OR m.data_matricula >= $P{dataInicio})
        AND ($P{dataFinal} IS NULL OR m.data_matricula <= $P{dataFinal})
        ORDER BY m.data_matricula DESC
        ]]>
    </queryString>
    
    <field name="id" class="java.lang.Integer"/>
    <field name="aluno_nome" class="java.lang.String"/>
    <field name="cpf" class="java.lang.String"/>
    <field name="curso_titulo" class="java.lang.String"/>
    <field name="data_matricula" class="java.sql.Timestamp"/>
    <field name="status" class="java.lang.Integer"/>
    <field name="parceiro_nome" class="java.lang.String"/>
    
    <title>
        <band height="100">
            <staticText>
                <reportElement x="0" y="0" width="555" height="30" uuid="a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d"/>
                <textElement textAlignment="Center">
                    <font size="18" isBold="true"/>
                </textElement>
                <text><![CDATA[Relatório de Matrículas]]></text>
            </staticText>
            <line>
                <reportElement x="0" y="35" width="555" height="1" uuid="b2c3d4e5-f6a7-4b8c-9d0e-1f2a3b4c5d6e"/>
            </line>
            <textField>
                <reportElement x="0" y="45" width="555" height="20" uuid="c3d4e5f6-a7b8-4c9d-0e1f-2a3b4c5d6e7f"/>
                <textElement textAlignment="Center">
                    <font size="10"/>
                </textElement>
                <textFieldExpression><![CDATA["Período: " + ($P{dataInicio} != null ? $P{dataInicio} : "Últimos 6 meses") + " a " + ($P{dataFinal} != null ? $P{dataFinal} : "Data atual")]]></textFieldExpression>
            </textField>
        </band>
    </title>
    
    <columnHeader>
        <band height="30">
            <staticText>
                <reportElement x="0" y="0" width="50" height="30" uuid="d4e5f6a7-b8c9-4d0e-1f2a-3b4c5d6e7f8a"/>
                <textElement verticalAlignment="Middle">
                    <font size="10" isBold="true"/>
                </textElement>
                <text><![CDATA[ID]]></text>
            </staticText>
            <staticText>
                <reportElement x="50" y="0" width="150" height="30" uuid="e5f6a7b8-c9d0-4e1f-2a3b-4c5d6e7f8a9b"/>
                <textElement verticalAlignment="Middle">
                    <font size="10" isBold="true"/>
                </textElement>
                <text><![CDATA[Aluno]]></text>
            </staticText>
            <staticText>
                <reportElement x="200" y="0" width="120" height="30" uuid="f6a7b8c9-d0e1-4f2a-3b4c-5d6e7f8a9b0c"/>
                <textElement verticalAlignment="Middle">
                    <font size="10" isBold="true"/>
                </textElement>
                <text><![CDATA[CPF]]></text>
            </staticText>
            <staticText>
                <reportElement x="320" y="0" width="150" height="30" uuid="a7b8c9d0-e1f2-4a3b-4c5d-6e7f8a9b0c1d"/>
                <textElement verticalAlignment="Middle">
                    <font size="10" isBold="true"/>
                </textElement>
                <text><![CDATA[Curso]]></text>
            </staticText>
            <staticText>
                <reportElement x="470" y="0" width="85" height="30" uuid="b8c9d0e1-f2a3-4b4c-5d6e-7f8a9b0c1d2e"/>
                <textElement verticalAlignment="Middle">
                    <font size="10" isBold="true"/>
                </textElement>
                <text><![CDATA[Data]]></text>
            </staticText>
        </band>
    </columnHeader>
    
    <detail>
        <band height="25">
            <textField>
                <reportElement x="0" y="0" width="50" height="25" uuid="c9d0e1f2-a3b4-4c5d-6e7f-8a9b0c1d2e3f"/>
                <textElement verticalAlignment="Middle">
                    <font size="9"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{id}]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement x="50" y="0" width="150" height="25" uuid="d0e1f2a3-b4c5-4d6e-7f8a-9b0c1d2e3f4a"/>
                <textElement verticalAlignment="Middle">
                    <font size="9"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{aluno_nome}]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement x="200" y="0" width="120" height="25" uuid="e1f2a3b4-c5d6-4e7f-8a9b-0c1d2e3f4a5b"/>
                <textElement verticalAlignment="Middle">
                    <font size="9"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{cpf}]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement x="320" y="0" width="150" height="25" uuid="f2a3b4c5-d6e7-4f8a-9b0c-1d2e3f4a5b6c"/>
                <textElement verticalAlignment="Middle">
                    <font size="9"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{curso_titulo}]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement x="470" y="0" width="85" height="25" uuid="a3b4c5d6-e7f8-4a9b-0c1d-2e3f4a5b6c7d"/>
                <textElement verticalAlignment="Middle">
                    <font size="9"/>
                </textElement>
                <textFieldExpression><![CDATA[new SimpleDateFormat("dd/MM/yyyy").format($F{data_matricula})]]></textFieldExpression>
            </textField>
        </band>
    </detail>
    
    <pageFooter>
        <band height="30">
            <textField>
                <reportElement x="0" y="10" width="555" height="20" uuid="b4c5d6e7-f8a9-4b0c-1d2e-3f4a5b6c7d8e"/>
                <textElement textAlignment="Center">
                    <font size="9"/>
                </textElement>
                <textFieldExpression><![CDATA["Página " + $V{PAGE_NUMBER} + " de " + $V{PAGE_COUNT}]]></textFieldExpression>
            </textField>
        </band>
    </pageFooter>
</jasperReport>