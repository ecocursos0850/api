<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" 
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
              xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports 
              http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" 
              name="parceiro" pageWidth="595" pageHeight="842" 
              columnWidth="555" leftMargin="20" rightMargin="20" 
              topMargin="20" bottomMargin="20" uuid="b7c8d9e0-f1a2-4b3c-9d8e-7f6g5h4i3j2k">
    
    <parameter name="parceiro" class="java.lang.Integer"/>
    <parameter name="dataInicio" class="java.lang.String"/>
    <parameter name="dataFinal" class="java.lang.String"/>
    
    <queryString>
        <![CDATA[
        SELECT 
            p.id,
            p.nome,
            p.email,
            p.telefone,
            p.cpf_cnpj,
            p.data_cadastro,
            COUNT(DISTINCT a.id) as total_alunos,
            COUNT(DISTINCT m.id) as total_matriculas
        FROM parceiro p
        LEFT JOIN aluno a ON p.id = a.parceiro_id
        LEFT JOIN matricula m ON a.id = m.aluno_id
        WHERE 1=1
        AND ($P{parceiro} IS NULL OR p.id = $P{parceiro})
        AND ($P{dataInicio} IS NULL OR p.data_cadastro >= $P{dataInicio})
        AND ($P{dataFinal} IS NULL OR p.data_cadastro <= $P{dataFinal})
        GROUP BY p.id, p.nome, p.email, p.telefone, p.cpf_cnpj, p.data_cadastro
        ORDER BY p.data_cadastro DESC
        ]]>
    </queryString>
    
    <field name="id" class="java.lang.Integer"/>
    <field name="nome" class="java.lang.String"/>
    <field name="email" class="java.lang.String"/>
    <field name="telefone" class="java.lang.String"/>
    <field name="cpf_cnpj" class="java.lang.String"/>
    <field name="data_cadastro" class="java.sql.Timestamp"/>
    <field name="total_alunos" class="java.lang.Long"/>
    <field name="total_matriculas" class="java.lang.Long"/>
    
    <title>
        <band height="100">
            <staticText>
                <reportElement x="0" y="0" width="555" height="30" uuid="c1d2e3f4-a5b6-4c7d-8e9f-0a1b2c3d4e5f"/>
                <textElement textAlignment="Center">
                    <font size="18" isBold="true"/>
                </textElement>
                <text><![CDATA[Relatório de Parceiros]]></text>
            </staticText>
            <line>
                <reportElement x="0" y="35" width="555" height="1" uuid="d2e3f4a5-b6c7-4d8e-9f0a-1b2c3d4e5f6a"/>
            </line>
        </band>
    </title>
    
    <detail>
        <band height="120">
            <rectangle>
                <reportElement x="0" y="0" width="555" height="110" backcolor="#F8F9FA" uuid="e3f4a5b6-c7d8-4e9f-0a1b-2c3d4e5f6a7b"/>
            </rectangle>
            
            <staticText>
                <reportElement x="10" y="10" width="100" height="20" uuid="f4a5b6c7-d8e9-4f0a-1b2c-3d4e5f6a7b8c"/>
                <textElement>
                    <font size="10" isBold="true"/>
                </textElement>
                <text><![CDATA[ID:]]></text>
            </staticText>
            <textField>
                <reportElement x="110" y="10" width="100" height="20" uuid="a5b6c7d8-e9f0-4a1b-2c3d-4e5f6a7b8c9d"/>
                <textElement>
                    <font size="10"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{id}]]></textFieldExpression>
            </textField>
            
            <staticText>
                <reportElement x="10" y="30" width="100" height="20" uuid="b6c7d8e9-f0a1-4b2c-3d4e-5f6a7b8c9d0e"/>
                <textElement>
                    <font size="10" isBold="true"/>
                </textElement>
                <text><![CDATA[Nome:]]></text>
            </staticText>
            <textField>
                <reportElement x="110" y="30" width="435" height="20" uuid="c7d8e9f0-a1b2-4c3d-4e5f-6a7b8c9d0e1f"/>
                <textElement>
                    <font size="10"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{nome}]]></textFieldExpression>
            </textField>
            
            <staticText>
                <reportElement x="10" y="50" width="100" height="20" uuid="d8e9f0a1-b2c3-4d4e-5f6a-7b8c9d0e1f2a"/>
                <textElement>
                    <font size="10" isBold="true"/>
                </textElement>
                <text><![CDATA[Email:]]></text>
            </staticText>
            <textField>
                <reportElement x="110" y="50" width="435" height="20" uuid="e9f0a1b2-c3d4-4e5f-6a7b-8c9d0e1f2a3b"/>
                <textElement>
                    <font size="10"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{email}]]></textFieldExpression>
            </textField>
            
            <staticText>
                <reportElement x="10" y="70" width="100" height="20" uuid="f0a1b2c3-d4e5-4f6a-7b8c-9d0e1f2a3b4c"/>
                <textElement>
                    <font size="10" isBold="true"/>
                </textElement>
                <text><![CDATA[Telefone:]]></text>
            </staticText>
            <textField>
                <reportElement x="110" y="70" width="200" height="20" uuid="a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d"/>
                <textElement>
                    <font size="10"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{telefone}]]></textFieldExpression>
            </textField>
            
            <staticText>
                <reportElement x="320" y="70" width="80" height="20" uuid="b2c3d4e5-f6a7-4b8c-9d0e-1f2a3b4c5d6e"/>
                <textElement>
                    <font size="10" isBold="true"/>
                </textElement>
                <text><![CDATA[Alunos:]]></text>
            </staticText>
            <textField>
                <reportElement x="400" y="70" width="50" height="20" uuid="c3d4e5f6-a7b8-4c9d-0e1f-2a3b4c5d6e7f"/>
                <textElement>
                    <font size="10"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{total_alunos}]]></textFieldExpression>
            </textField>
            
            <staticText>
                <reportElement x="450" y="70" width="80" height="20" uuid="d4e5f6a7-b8c9-4d0e-1f2a-3b4c5d6e7f8a"/>
                <textElement>
                    <font size="10" isBold="true"/>
                </textElement>
                <text><![CDATA[Matrículas:]]></text>
            </staticText>
            <textField>
                <reportElement x="530" y="70" width="25" height="20" uuid="e5f6a7b8-c9d0-4e1f-2a3b-4c5d6e7f8a9b"/>
                <textElement>
                    <font size="10"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{total_matriculas}]]></textFieldExpression>
            </textField>
            
            <staticText>
                <reportElement x="10" y="90" width="100" height="20" uuid="f6a7b8c9-d0e1-4f2a-3b4c-5d6e7f8a9b0c"/>
                <textElement>
                    <font size="10" isBold="true"/>
                </textElement>
                <text><![CDATA[Data Cadastro:]]></text>
            </staticText>
            <textField>
                <reportElement x="110" y="90" width="150" height="20" uuid="a7b8c9d0-e1f2-4a3b-4c5d-6e7f8a9b0c1d"/>
                <textElement>
                    <font size="10"/>
                </textElement>
                <textFieldExpression><![CDATA[new SimpleDateFormat("dd/MM/yyyy").format($F{data_cadastro})]]></textFieldExpression>
            </textField>
        </band>
    </detail>
    
    <pageFooter>
        <band height="30">
            <textField>
                <reportElement x="0" y="10" width="555" height="20" uuid="b8c9d0e1-f2a3-4b4c-5d6e-7f8a9b0c1d2e"/>
                <textElement textAlignment="Center">
                    <font size="9"/>
                </textElement>
                <textFieldExpression><![CDATA["Página " + $V{PAGE_NUMBER} + " de " + $V{PAGE_COUNT}]]></textFieldExpression>
            </textField>
        </band>
    </pageFooter>
</jasperReport>